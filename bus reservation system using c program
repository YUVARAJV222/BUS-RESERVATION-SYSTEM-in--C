#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// Function prototypes
void login();
void bus(); 
void name_number(int booking, char numstr[100]);
void booking();
int read_number(int trno);
void read_name(int trno);
void status();
void status_1(int trno);
void cancle();
char* itoa(int value, char* str, int base); // Custom itoa function prototype

// Global variables
char ch[10][130] = {"Manglore Express", "Karwar Express", "Airavat Express", "SeaBird Express", "Newport Express", "VRL Express"};
char name[32][100] = {'\0'};
char number[32][2] = {'\0'};
int num1[32] = {0};
int trno;

int main() {
    login();
    int num;
    do {
        system("cls");
        printf("\n\n\n");
        printf("====================================== WELCOME TO BUS RESERVATION SYSTEM ======================================\n\n\n");
        printf("\t\t\t\t\t[1]=> View Bus List\n");
        printf("\t\t\t\t\t[2]=> Book Tickets\n");
        printf("\t\t\t\t\t[3]=> Cancel Booking\n");
        printf("\t\t\t\t\t[4]=> Bus Status Board\n");
        printf("\t\t\t\t\t[5]=> Exit\n\n");
        printf("===============================================================================================================\n\n");
        printf("\t\t\tEnter Your Choice:: ");
        scanf("%d", &num);
        switch(num) {
            case 1:
                bus();
                break;
            case 2:
                booking();
                break;
            case 3:
                cancle();
                break;
            case 4:
                status();
                break;
        }
        // getch(); // Uncomment if you have a getch implementation
    } while(num != 5);
    system("cls");
    printf("\t----------------------------------------------------------------------------------------------------------\n");
    printf("\t\t\t\t\tThank You For Using This System\t\t\t\t\t\t\n");
    printf("\t----------------------------------------------------------------------------------------------------------\n");
    // getch(); // Uncomment if you have a getch implementation
    return 0;
}

void bus() {
    system("cls");
    printf("\n\n\n");
    printf("=========================================== BUS RESERVATION SYSTEM ============================================\n\n\n");
    for (int i = 0; i < 5; i++) {
        printf("\t\t\t\t\t[%d]  =>  %s\n", i + 1, ch[i]);
    }
}

void booking() {
    int i = 0;
    char numstr[100];
    system("cls");
    printf("=========================================== BUS RESERVATION SYSTEM ============================================\n\n\n");
    bus();
    printf("Enter the Bus number:--->");
    scanf("%d", &trno);
    system("cls");
    printf("=========================================== BUS RESERVATION SYSTEM ============================================\n\n\n");
    printf("Your Bus Number is %d ********** %s", trno, ch[trno - 1]);
    status_1(trno);
    
    FILE *f1;
    char str1[80] = "32";
    int seat1, booking = 0;

    f1 = fopen("tr%d.txt", "r+", trno); // Use format specifier
    if (f1) {
        fgets(str1, sizeof(str1), f1);
        fclose(f1);
    } else {
        printf("Error opening file for bus number %d\n", trno);
        return;
    }

    seat1 = atoi(str1); // Convert string to number
    if (seat1 <= 0) {
        printf("There are no blank seats in this bus.");
    } else {
        printf("\n\n\n\t\t\t\tAvailable Seats:------>%d\n", seat1);
        printf("\n\t\t\t\tNumber of Tickets:----->");
        scanf("%d", &booking);
        seat1 -= booking;
        itoa(trno, numstr, 10);
        name_number(booking, numstr);
        printf("\n\t\t\t\tThe Total booking amount is %d", 200 * booking);
        itoa(seat1, str1, 10);
        
        f1 = fopen("tr%d.txt", "w", trno);
        if (f1) {
            fputs(str1, f1);
            fclose(f1);
        } else {
            printf("Error writing to file for bus number %d\n", trno);
        }
    }
}

void name_number(int booking, char numstr[100]) {
    char tempstr[100], tempstr1[12] = "status", tempstr2[12] = "number";
    int number;
    FILE *a, *b;
    strcat(numstr, ".txt");
    strcat(tempstr1, numstr);
    strcat(tempstr2, numstr);
    a = fopen(tempstr1, "a");
    b = fopen(tempstr2, "a");

    for (int i = 0; i < booking; i++) {
        printf("============================Enter the details for ticket no %d============================\n\n\n", i + 1);
        printf("\t\t\t\tEnter the seat number:--->");
        scanf("%d", &number);
        printf("\t\t\t\tEnter the name of person:--->");
        scanf("%s", name[number - 1]);
        itoa(number, tempstr, 10);
        fprintf(a, "%s ", name[number - 1]);
        fprintf(b, "%s ", tempstr);
    }
    fclose(a);
    fclose(b);
}

int read_number(int trno) {
    char tempstr[100], tempstr2[12] = "number";
    FILE *a;
    char numstr[100];
    int i = 0, j = 0;

    itoa(trno, numstr, 10);
    strcat(numstr, ".txt");
    strcat(tempstr2, numstr);
    a = fopen(tempstr2, "a+");

    while (!feof(a)) {
        number[i][j] = fgetc(a);
        if (number[i][j] == ' ') {
            j = 0;
            i++;
        } else {
            j++;
        }
    }

    int k = i;
    for (i = 0; i < k; i++) {
        num1[i] = atoi(number[i]);
    }
    fclose(a);
    return k;
}

void read_name(int trno) {
    char tempstr1[12] = "status";
    FILE *b;
    char numstr[100];
    int i = 0, j = 0;

    itoa(trno, numstr, 10);
    strcat(numstr, ".txt");
    strcat(tempstr1, numstr);
    b = fopen(tempstr1, "a+");

    while (!feof(b)) {
        name[i][j] = fgetc(b);
        if (name[i][j] == ' ') {
            j = 0;
            i++;
        } else {
            j++;
        }
    }
    name[i][j] = '\0';
    fclose(b);
}

void status() {
    system("cls");
    printf("=========================================== BUS RESERVATION SYSTEM ============================================\n\n\n");
    printf("Enter the number of bus:---->");
    scanf("%d", &trno);
    int j = read_number(trno);
    read_name(trno);
    printf("____________________________________________________________________________________________________________________\n");
    printf("                                      Bus.no-->%d---->%s                                                            \n", trno, ch[trno - 1]);
    printf("____________________________________________________________________________________________________________________\n");

    char tempname[33][10] = {"Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ",
                              "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ",
                              "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ",
                              "Empty ", "Empty ", "Empty ", "Empty ", "Empty "};

    for (int i = 0; i < j; i++) {
        strcpy(tempname[num1[i]], name[i]);
    }

    for (int i = 0; i < 8; i++) {
        printf("\t\t\t\t");
        for (int j = 0; j < 4; j++) {
            printf("%d.%s\t", index + 1, tempname[index + 1]);
            index++;
        }
        printf("\n");
    }
}

void status_1(int trno) {
    printf("Your Bus Number is %d ********** %s", trno, ch[trno - 1]);
    system("cls");
    printf("=========================================== BUS RESERVATION SYSTEM ============================================\n\n\n");
    int j = read_number(trno);
    read_name(trno);
    char tempname[33][10] = {"Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ", "Empty ",
                              "Empty ", "Empty
